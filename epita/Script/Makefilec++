CXX=g++
SRC=td.cc
#CSRC=
CFLAGSX=-fprofile -arcs -ftest -coverage
LDLIBS= -lgov

#Create library
CXXFLAGS=-std=c++14 -pedantic -Wextra -Wall -Werror -fPIC
CHECKDIR=check
COBJ=$(addprefix $(CHECKDIR)/, $(CSRC:.c=.o))
OBJS=$(addprefix $(OBJDIR)/, $(SRC:.c=.o))
OBJS=$(SRC:.c=.o)
LIBS=libstring.a
LIBD=libfnmatch.so
EXE=td

all: $(EXE)

release:$(EXE)

debug: CFLAGSX +=-g -ggdb3 _GLIBCXX_DEBUG

debug:release

$(OBJDIR):
	mkdir -p $@

$(OBJDIR)/%.o: %.c
	$(CXX) $(CXXFLAGS) -c -o $@ $^

$(CHECKDIR)/%.o: %.c
	$(CXX) $(CXXFLAGS) -c -o $@ $^

$(EXE): $(OBJS) $(COBJ)
	$(CXX) $(CXXFLAGS) -o $(EXE) $^

%.o: %.c
	$(CXX) $(CXXFLAGS) -c -o $@ $^

$(LIBS):$(OBJS)
	ar csr -o $@ $^

static:$(OBJS)
	ar csr -o $@ $^

$(LIBD):$(OBJS) $(COBJ)
	$(CXX) $(CXXFLAGS) -shared -o $@ $^

dynamique:$(OBJS)
	$(CXX) $(CXXFLAGS) -shared -o $@ $^

check:$(EXE)
	check/check.sh
#	$(CC) $(CFLAGSX) $(LDLIBS) -o $@ $^

clean:
	rm -f $(OBJS) $(COBJ)

distclean:
	rm -f $(OBJS) $(LIBS) $(LIBD) $(EXE)
